{"remainingRequest":"C:\\workspace-jidea\\imprendocasa\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\workspace-jidea\\imprendocasa\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\workspace-jidea\\imprendocasa\\node_modules\\angular-router-loader\\src\\index.js!C:\\workspace-jidea\\imprendocasa\\node_modules\\tslint-loader\\index.js!C:\\workspace-jidea\\imprendocasa\\src\\main\\webapp\\app\\entities\\cliente\\cliente-update.component.ts","dependencies":[{"path":"C:\\workspace-jidea\\imprendocasa\\src\\main\\webapp\\app\\entities\\cliente\\cliente-update.component.ts","mtime":1548761751662},{"path":"C:\\workspace-jidea\\imprendocasa\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"C:\\workspace-jidea\\imprendocasa\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1548763036447},{"path":"C:\\workspace-jidea\\imprendocasa\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1548763032809},{"path":"C:\\workspace-jidea\\imprendocasa\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"C:\\workspace-jidea\\imprendocasa\\node_modules\\angular-router-loader\\src\\index.js","mtime":1512749902000},{"path":"C:\\workspace-jidea\\imprendocasa\\node_modules\\tslint-loader\\index.js","mtime":1519899048000}],"contextDependencies":[],"result":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar core_1 = require(\"@angular/core\");\r\nvar router_1 = require(\"@angular/router\");\r\nvar ng_jhipster_1 = require(\"ng-jhipster\");\r\nvar cliente_service_1 = require(\"./cliente.service\");\r\nvar tag_model_1 = require(\"app/shared/model/tag.model\");\r\nvar tag_1 = require(\"app/entities/tag\");\r\nvar incarico_1 = require(\"app/entities/incarico\");\r\nvar google_utils_1 = require(\"app/shared/util/google-utils\");\r\nvar core_2 = require(\"@agm/core\");\r\nvar forms_1 = require(\"@angular/forms\");\r\nvar core_3 = require(\"app/core\");\r\nvar ClienteUpdateComponent = /** @class */ (function () {\r\n    function ClienteUpdateComponent(dataUtils, jhiAlertService, clienteService, incaricoService, tagService, mapsAPILoader, userService, activatedRoute, router, ngZone) {\r\n        this.dataUtils = dataUtils;\r\n        this.jhiAlertService = jhiAlertService;\r\n        this.clienteService = clienteService;\r\n        this.incaricoService = incaricoService;\r\n        this.tagService = tagService;\r\n        this.mapsAPILoader = mapsAPILoader;\r\n        this.userService = userService;\r\n        this.activatedRoute = activatedRoute;\r\n        this.router = router;\r\n        this.ngZone = ngZone;\r\n        this.users = [];\r\n    }\r\n    ClienteUpdateComponent.prototype.ngOnInit = function () {\r\n        var _this = this;\r\n        this.isSaving = false;\r\n        // this.incaricoService.query().subscribe(\r\n        //     (res: HttpResponse<Incarico[]>) => {\r\n        //         this.incaricoCommittentes = res.body;\r\n        //     },\r\n        //     (res: HttpErrorResponse) => this.onError(res.message)\r\n        // );\r\n        // parametri del routing alla creazione del componente\r\n        this.incaricoRef = this.activatedRoute.snapshot.queryParamMap.get('incaricoRef') || null;\r\n        var clienteTagStr = this.activatedRoute.snapshot.queryParamMap.get('clienteTag') || null;\r\n        if (clienteTagStr) {\r\n            this.clienteTag = tag_model_1.TagEnum[clienteTagStr];\r\n        }\r\n        // parametri del routing asincroni\r\n        this.activatedRoute.data.subscribe(function (data) {\r\n            _this.cliente = data['cliente'];\r\n            _this.tags = data['tags'];\r\n            if (_this.clienteTag) {\r\n                // TODO:\r\n                var foundTag_1 = _this.tags.find(function (tag) { return tag.codice === _this.clienteTag; });\r\n                if (foundTag_1) {\r\n                    setTimeout(function () {\r\n                        _this.formCliente.controls['tag'].setValue([foundTag_1]);\r\n                        _this.formCliente.controls['tag'].disable();\r\n                    }, 0);\r\n                }\r\n            }\r\n            else {\r\n                setTimeout(function () {\r\n                    _this.formCliente.controls['tag'].enable();\r\n                }, 0);\r\n            }\r\n            _this.retrieveCordinate();\r\n            _this.retrieveUsersAgents();\r\n        });\r\n        this.searchControl = new forms_1.FormControl();\r\n    };\r\n    ClienteUpdateComponent.prototype.retrieveUsersAgents = function () {\r\n        var _this = this;\r\n        this.userService.queryAgents().subscribe(function (res) {\r\n            return _this.onQueryAgentsSuccess(res.body);\r\n        }, function (res) { return _this.onError(res.body); });\r\n    };\r\n    ClienteUpdateComponent.prototype.byteSize = function (field) {\r\n        return this.dataUtils.byteSize(field);\r\n    };\r\n    ClienteUpdateComponent.prototype.onQueryAgentsSuccess = function (users) {\r\n        this.users = users;\r\n        if (this.isAgenteDisabled()) {\r\n            this.cliente.agente = this.users[0].login;\r\n        }\r\n    };\r\n    ClienteUpdateComponent.prototype.openFile = function (contentType, field) {\r\n        return this.dataUtils.openFile(contentType, field);\r\n    };\r\n    ClienteUpdateComponent.prototype.setFileData = function (event, entity, field, isImage) {\r\n        this.dataUtils.setFileData(event, entity, field, isImage);\r\n    };\r\n    ClienteUpdateComponent.prototype.retrieveCordinate = function () {\r\n        var _this = this;\r\n        this.mapsAPILoader.load().then(function () {\r\n            google_utils_1.autoComplete(_this.cliente, _this.searchElementRef, _this.ngZone, null, new google_utils_1.MapsData());\r\n        });\r\n    };\r\n    ClienteUpdateComponent.prototype.isAgenteDisabled = function () {\r\n        return this.users && this.users.length === 1;\r\n    };\r\n    ClienteUpdateComponent.prototype.save = function () {\r\n        this.isSaving = true;\r\n        if (this.cliente.id !== undefined) {\r\n            this.subscribeToSaveResponse(this.clienteService.update(this.cliente));\r\n        }\r\n        else {\r\n            this.subscribeToSaveResponse(this.clienteService.create(this.cliente));\r\n        }\r\n    };\r\n    ClienteUpdateComponent.prototype.subscribeToSaveResponse = function (result) {\r\n        var _this = this;\r\n        result.subscribe(function (res) { return _this.onSaveSuccess(res.body); }, function (res) { return _this.onSaveError(res); });\r\n    };\r\n    ClienteUpdateComponent.prototype.onSaveSuccess = function (newCliente) {\r\n        this.isSaving = false;\r\n        this.previousState(newCliente);\r\n    };\r\n    ClienteUpdateComponent.prototype.onSaveError = function (res) {\r\n        this.isSaving = false;\r\n        this.onError(res.message);\r\n    };\r\n    ClienteUpdateComponent.prototype.onError = function (errorMessage) {\r\n        this.jhiAlertService.error(errorMessage, null, null);\r\n    };\r\n    ClienteUpdateComponent.prototype.previousState = function (newCliente) {\r\n        if (newCliente && newCliente.id) {\r\n            if (this.incaricoRef) {\r\n                var incaricoRefNumber = Number(this.incaricoRef);\r\n                var extras = { queryParams: { clienteRef: newCliente.id } };\r\n                var isExistingRef = incaricoRefNumber > 0;\r\n                var navigationUrl = isExistingRef ? [\"incarico/\" + incaricoRefNumber + \"/edit\"] : ['incarico/new'];\r\n                this.router.navigate(navigationUrl, extras);\r\n            }\r\n            else {\r\n                window.history.back();\r\n            }\r\n        }\r\n        else {\r\n            window.history.back();\r\n        }\r\n    };\r\n    ClienteUpdateComponent.prototype.trackIncaricoById = function (index, item) {\r\n        return item.id;\r\n    };\r\n    ClienteUpdateComponent.prototype.trackItemById = function (index, item) {\r\n        return item.id;\r\n    };\r\n    ClienteUpdateComponent.prototype.getSelected = function (selectedVals, option) {\r\n        if (selectedVals) {\r\n            for (var i = 0; i < selectedVals.length; i++) {\r\n                if (option.id === selectedVals[i].id) {\r\n                    return selectedVals[i];\r\n                }\r\n            }\r\n        }\r\n        return option;\r\n    };\r\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\r\n    tslib_1.__decorate([\r\n        core_1.ViewChild('formCliente'),\r\n        tslib_1.__metadata(\"design:type\", typeof (_a = typeof forms_1.FormGroup !== \"undefined\" && forms_1.FormGroup) === \"function\" ? _a : Object)\r\n    ], ClienteUpdateComponent.prototype, \"formCliente\", void 0);\r\n    tslib_1.__decorate([\r\n        core_1.ViewChild('search'),\r\n        tslib_1.__metadata(\"design:type\", typeof (_b = typeof core_1.ElementRef !== \"undefined\" && core_1.ElementRef) === \"function\" ? _b : Object)\r\n    ], ClienteUpdateComponent.prototype, \"searchElementRef\", void 0);\r\n    ClienteUpdateComponent = tslib_1.__decorate([\r\n        core_1.Component({\r\n            selector: 'jhi-cliente-update',\r\n            templateUrl: './cliente-update.component.html'\r\n        }),\r\n        tslib_1.__metadata(\"design:paramtypes\", [typeof (_c = typeof ng_jhipster_1.JhiDataUtils !== \"undefined\" && ng_jhipster_1.JhiDataUtils) === \"function\" ? _c : Object, typeof (_d = typeof ng_jhipster_1.JhiAlertService !== \"undefined\" && ng_jhipster_1.JhiAlertService) === \"function\" ? _d : Object, typeof (_e = typeof cliente_service_1.ClienteService !== \"undefined\" && cliente_service_1.ClienteService) === \"function\" ? _e : Object, typeof (_f = typeof incarico_1.IncaricoService !== \"undefined\" && incarico_1.IncaricoService) === \"function\" ? _f : Object, typeof (_g = typeof tag_1.TagService !== \"undefined\" && tag_1.TagService) === \"function\" ? _g : Object, typeof (_h = typeof core_2.MapsAPILoader !== \"undefined\" && core_2.MapsAPILoader) === \"function\" ? _h : Object, typeof (_j = typeof core_3.UserService !== \"undefined\" && core_3.UserService) === \"function\" ? _j : Object, typeof (_k = typeof router_1.ActivatedRoute !== \"undefined\" && router_1.ActivatedRoute) === \"function\" ? _k : Object, typeof (_l = typeof router_1.Router !== \"undefined\" && router_1.Router) === \"function\" ? _l : Object, typeof (_m = typeof core_1.NgZone !== \"undefined\" && core_1.NgZone) === \"function\" ? _m : Object])\r\n    ], ClienteUpdateComponent);\r\n    return ClienteUpdateComponent;\r\n}());\r\nexports.ClienteUpdateComponent = ClienteUpdateComponent;\r\n",{"version":3,"file":"C:\\workspace-jidea\\imprendocasa\\src\\main\\webapp\\app\\entities\\cliente\\cliente-update.component.ts","sourceRoot":"","sources":["C:\\workspace-jidea\\imprendocasa\\node_modules\\angular-router-loader\\src\\index.js!C:\\workspace-jidea\\imprendocasa\\node_modules\\tslint-loader\\index.js!C:\\workspace-jidea\\imprendocasa\\src\\main\\webapp\\app\\entities\\cliente\\cliente-update.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {Component, ElementRef, NgZone, OnInit, ViewChild} from '@angular/core';\nimport {ActivatedRoute, Router} from '@angular/router';\nimport {HttpErrorResponse, HttpResponse} from '@angular/common/http';\nimport {Observable} from 'rxjs';\nimport {JhiAlertService, JhiDataUtils} from 'ng-jhipster';\n\nimport {Cliente} from 'app/shared/model/cliente.model';\nimport {ClienteService} from './cliente.service';\nimport {Tag, TagEnum} from 'app/shared/model/tag.model';\nimport {TagService} from 'app/entities/tag';\nimport {Incarico} from 'app/shared/model/incarico.model';\nimport {IncaricoService} from 'app/entities/incarico';\nimport {autoComplete, MapsData} from 'app/shared/util/google-utils';\nimport {MapsAPILoader} from '@agm/core';\nimport {FormControl, FormGroup} from '@angular/forms';\nimport {User, UserService} from 'app/core';\nimport {IMPORT_VALIDATOR} from 'app/shared';\n\n@Component({\n    selector: 'jhi-cliente-update',\n    templateUrl: './cliente-update.component.html'\n})\nexport class ClienteUpdateComponent implements OnInit {\n    cliente: Cliente;\n    isSaving: boolean;\n\n    private incaricoRef: string;\n\n    tags: Tag[];\n//    incaricos: Incarico[]; // FIXME\n    incaricoCommittentes: Incarico[]; // FIXME\n    incaricoProponentes: Incarico[]; // FIXME\n    incaricoAcquirenteLocatarios: Incarico[]; // FIXME\n    incaricoSegnalatores: Incarico[]; // FIXME\n\n    dataNascitaDp: any;\n    clienteTag: TagEnum;\n\n    @ViewChild('formCliente')\n    formCliente: FormGroup;\n    users: User[] = [];\n    @ViewChild('search')\n    public searchElementRef: ElementRef;\n    public searchControl: FormControl;\n\n    constructor(\n        private dataUtils: JhiDataUtils,\n        private jhiAlertService: JhiAlertService,\n        private clienteService: ClienteService,\n        private incaricoService: IncaricoService,\n        private tagService: TagService,\n        private mapsAPILoader: MapsAPILoader,\n        private userService: UserService,\n        private activatedRoute: ActivatedRoute,\n        private router: Router,\n        private ngZone: NgZone,\n    ) {\n    }\n\n    ngOnInit() {\n        this.isSaving = false;\n\n        // this.incaricoService.query().subscribe(\n        //     (res: HttpResponse<Incarico[]>) => {\n        //         this.incaricoCommittentes = res.body;\n        //     },\n        //     (res: HttpErrorResponse) => this.onError(res.message)\n        // );\n\n        // parametri del routing alla creazione del componente\n        this.incaricoRef = this.activatedRoute.snapshot.queryParamMap.get('incaricoRef') || null;\n\n        const clienteTagStr = this.activatedRoute.snapshot.queryParamMap.get('clienteTag') || null;\n        if (clienteTagStr) {\n            this.clienteTag = TagEnum[clienteTagStr];\n        }\n        // parametri del routing asincroni\n        this.activatedRoute.data.subscribe(data => {\n            this.cliente = data['cliente'];\n            this.tags = data['tags'];\n\n            if (this.clienteTag) {\n                // TODO:\n                const foundTag = this.tags.find(tag => tag.codice === this.clienteTag);\n                if (foundTag) {\n                    setTimeout(() => {\n                        this.formCliente.controls['tag'].setValue([foundTag]);\n                        this.formCliente.controls['tag'].disable();\n                    }, 0);\n                }\n            } else {\n                setTimeout(() => {\n                    this.formCliente.controls['tag'].enable();\n                }, 0);\n            }\n\n            this.retrieveCordinate();\n            this.retrieveUsersAgents();\n        });\n\n        this.searchControl = new FormControl();\n    }\n\n    private retrieveUsersAgents() {\n        this.userService.queryAgents().subscribe(\n            (res: HttpResponse<User[]>) =>\n                this.onQueryAgentsSuccess(res.body),\n            (res: HttpResponse<any>) => this.onError(res.body)\n        );\n    }\n\n    byteSize(field) {\n        return this.dataUtils.byteSize(field);\n    }\n\n    private onQueryAgentsSuccess(users) {\n        this.users = users;\n\n        if (this.isAgenteDisabled()) {\n            this.cliente.agente = this.users[0].login;\n        }\n    }\n\n    openFile(contentType, field) {\n        return this.dataUtils.openFile(contentType, field);\n    }\n\n    setFileData(event, entity, field, isImage) {\n        this.dataUtils.setFileData(event, entity, field, isImage);\n    }\n\n    retrieveCordinate() {\n        this.mapsAPILoader.load().then(() => {\n            autoComplete(this.cliente, this.searchElementRef, this.ngZone, null, new MapsData());\n        });\n    }\n\n    isAgenteDisabled(): boolean {\n        return this.users && this.users.length === 1;\n    }\n\n    save() {\n        this.isSaving = true;\n        if (this.cliente.id !== undefined) {\n            this.subscribeToSaveResponse(this.clienteService.update(this.cliente));\n        } else {\n            this.subscribeToSaveResponse(this.clienteService.create(this.cliente));\n        }\n    }\n\n    private subscribeToSaveResponse(result: Observable<HttpResponse<Cliente>>) {\n        result.subscribe(\n            (res: HttpResponse<Cliente>) => this.onSaveSuccess(res.body),\n            (res: HttpErrorResponse) => this.onSaveError(res));\n    }\n\n    private onSaveSuccess(newCliente: Cliente) {\n        this.isSaving = false;\n        this.previousState(newCliente);\n    }\n\n    private onSaveError(res: HttpErrorResponse) {\n        this.isSaving = false;\n        this.onError(res.message);\n    }\n\n    private onError(errorMessage: string) {\n        this.jhiAlertService.error(errorMessage, null, null);\n    }\n\n    previousState(newCliente?: Cliente) {\n        if (newCliente && newCliente.id) {\n            if (this.incaricoRef) {\n                const incaricoRefNumber = Number(this.incaricoRef);\n\n                const extras = {queryParams: {clienteRef: newCliente.id}};\n                const isExistingRef = incaricoRefNumber > 0;\n                const navigationUrl = isExistingRef ? [`incarico/${incaricoRefNumber}/edit`] : ['incarico/new'];\n\n                this.router.navigate(navigationUrl, extras);\n            } else {\n                window.history.back();\n            }\n        } else {\n            window.history.back();\n        }\n    }\n\n    trackIncaricoById(index: number, item: Incarico) {\n        return item.id;\n    }\n\n    trackItemById(index: number, item: any) {\n        return item.id;\n    }\n\n    getSelected(selectedVals: Array<any>, option: any) {\n        if (selectedVals) {\n            for (let i = 0; i < selectedVals.length; i++) {\n                if (option.id === selectedVals[i].id) {\n                    return selectedVals[i];\n                }\n            }\n        }\n        return option;\n    }\n}\n"]}]}